# Account Invoices Endpoints

## Apply a deposit to an invoice (POST)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/apply_deposit/:deposit_id`
- **Description**: Apply a deposit to an invoice. This will only work if the invoice has a remaining_due greater than 0 and the deposit has an amount_remaining greater than 0.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
    - `deposit_id` (Number, required): The ID of the deposit
- **Success Response (200 OK)**:
    ```json
    {
        "data": {
            "id": 311,
            "date": "2015-09-23",
            "frozen": false,
            "remaining_due": "0.00",
            "child_remaining_due": "0.00",
            "number_of_months": 1,
            "master_invoice_id": 0,
            "due_date": "2015-10-03",
            "delinquent": false,
            "auto_pay": "2015-09-23",
            "auto_pay_attempted": true,
            "void": false
        }
    }
    ```

## Apply a discount to an invoice (POST)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/apply_discount/:discount_id`
- **Description**: Apply a discount to an invoice. This will only work if the invoice has a remaining_due greater than 0 and the discount has an amount_remaining greater than 0.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
    - `discount_id` (Number, required): The ID of the discount
- **Success Response (200 OK)**:
    ```json
    {
        "data": {
            "id": 311,
            "date": "2015-09-23",
            "frozen": false,
            "remaining_due": "0.00",
            "child_remaining_due": "0.00",
            "number_of_months": 1,
            "master_invoice_id": 0,
            "due_date": "2015-10-03",
            "delinquent": false,
            "auto_pay": "2015-09-23",
            "auto_pay_attempted": true,
            "void": false
        }
    }
    ```

## Create invoice (POST)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices`
- **Description**: Create an invoice from uninvoiced debits.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `debits` (Array, required): An array of debit IDs. These debits must be currently uninvoiced.
    - `due_date` (Date, optional): A due date in YYYY-MM-DD format. If this is omitted, the account 'due_days' parameter will be used to calculate a due date
- **Success Response (200 OK)**:
    ```json
    {
        "data": {
            "id": 312,
            "date": "2015-09-23",
            "frozen": false,
            "remaining_due": "15.32",
            "child_remaining_due": "0.00",
            "number_of_months": 1,
            "master_invoice_id": 0,
            "due_date": "2015-10-03",
            "delinquent": false,
            "auto_pay": "2015-09-23",
            "auto_pay_attempted": true,
            "void": false
        }
    }
    ```
- **Error Response (422 Unprocessable Entity)**:
    ```json
    {
        "error": {
            "message": {
                "debits": "Debit ID 12345 has already been invoiced."
            },
            "status_code": 422
        }
    }
    ```

## Delete an invoice (DELETE)
- **Version**: 0.6.0
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id`
- **Description**: Delete an invoice. Invoices can only be deleted in limited circumstances - they must be created manually (not an automatic, recurring invoice) and the invoice date must be after the last accounting period close date. Once an invoice is deleted, any credits applied, or debits included in the invoice, will be returned to the account.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (200 OK)**:
    ```json
    {
      "data": {
        "success": true
      }
    }
    ```
- **Error Response (422 Unprocessable Entity)**:
    ```json
    {
       "error": {
         "message": "You cannot delete an invoice generated by the automatic billing process. Only manually created invoices can be deleted.",
         "status_code": 422
       }
    }
    ```

## Freeze invoice (POST)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/freeze`
- **Description**: Freeze an invoice. This requires account super user permissions.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (200 OK)**:
    ```json
    {
        "data": {
            "id": 311,
            "date": "2015-09-23",
            "frozen": false,
            "remaining_due": "0.00",
            "child_remaining_due": "0.00",
            "number_of_months": 1,
            "master_invoice_id": 0,
            "due_date": "2015-10-03",
            "delinquent": false,
            "auto_pay": "2015-09-23",
            "auto_pay_attempted": true,
            "void": false
        }
    }
    ```

## Get a base64 encoded invoice PDF (GET)
- **Version**: 0.6.0
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/pdf`
- **Description**: Get an invoice as a PDF, base64 encoded
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (201 Created)**:
    ```json
    {
      "data": {
        "invoice_id": 1,
        "account_id": 22,
        "base64": "JVBERi0xLjQK...."
      }
    }
    ```
- **Error Response (404 Not Found)**:
    ```json
    {
       "error": {
         "message": "No item with that ID found.",
         "status_code": 404
       }
    }
    ```

## Get a base64 encoded statement PDF (GET)
- **Version**: 1.2.19
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/pdf`
- **Description**: Get an invoice as a PDF, base64 encoded
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (201 Created)**:
    ```json
    {
      "data": {
        "invoice_id": 1,
        "account_id": 22,
        "base64": "JVBERi0xLjQK...."
      }
    }
    ```
- **Error Response (404 Not Found)**:
    ```json
    {
       "error": {
         "message": "No item with that ID found.",
         "status_code": 404
       }
    }
    ```

## Get all account invoices (GET)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices`
- **Description**: Get a list of the invoices for the account
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `limit` (Number, optional): The number of entries to return
    - `page` (Number, optional): The page of results to return
- **Success Response (200 OK)**:
    ```json
    {
      "data": [
        {
          "id": 311,
          "date": "2015-09-23",
          "frozen": false,
          "remaining_due": "0.00",
          "child_remaining_due": "0.00",
          "number_of_months": 1,
          "master_invoice_id": 0,
          "due_date": "2015-10-03",
          "delinquent": false,
          "auto_pay": "2015-09-23",
          "auto_pay_attempted": true,
          "void": false
        }
      ],
      "paginator": {
        "total_count": 1,
        "total_pages": 1,
        "current_page": 1,
        "limit": 100
      }
    }
    ```

## Get individual account invoice credits (GET)
- **Version**: 0.2.0
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/credits`
- **Description**: Get an individual account invoice credits.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (200 OK)**:
    ```json
    {
      "data": [
        {
          "id": 263,
          "amount": 60.50,
          "void": false,
          "deposit_id": 5,
          "discount_id": 0,
          "date": "2015-09-23 16:55:13"
        }
      ],
      "paginator": {
        "total_count": 1,
        "total_pages": 1,
        "current_page": 1,
        "limit": 100
      }
    }
    ```

## Get individual account invoice debits (GET)
- **Version**: 0.2.0
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/debits`
- **Description**: Get an individual account invoice debits.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (200 OK)**:
    ```json
    {
      "data": [
        {
          "id": 361,
          "amount": 34.34,
          "invoice_id": 366,
          "service_id": 22,
          "date": "2015-09-25 16:07:57",
          "reversed": false,
          "reversed_at": null,
          "discount_id": null,
          "number_of_months": 1,
          "taxes": []
        }
      ],
      "paginator": {
        "total_count": 1,
        "total_pages": 1,
        "current_page": 1,
        "limit": 100
      }
    }
    ```

## Get individual account invoice (GET)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id`
- **Description**: Get an individual account invoice.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (200 OK)**:
    ```json
    {
        "data": {
            "id": 311,
            "date": "2015-09-23",
            "frozen": false,
            "remaining_due": "0.00",
            "child_remaining_due": "0.00",
            "number_of_months": 1,
            "master_invoice_id": 0,
            "due_date": "2015-10-03",
            "delinquent": false,
            "auto_pay": "2015-09-23",
            "auto_pay_attempted": true,
            "void": false
        }
    }
    ```

## Link a child invoice to a master (PATCH)
- **Version**: 1.1.9
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/link`
- **Description**: Link a child invoice to a master. This generally does not need to be done manually, and is performed automatically by regular billing. Don't use this function unless you know exactly why you're using it!
- **Parameters**:
    - `account_id` (Integer, required): The ID of the account
    - `invoice_id` (Integer, required): The ID of the master invoice
    - `child_invoice_id` (Integer, required): The ID of the child invoice
- **Success Response (200 OK)**:
    ```json
    {
        "data": {
            "id": 311,
            "date": "2015-09-23",
            "frozen": false,
            "remaining_due": "0.00",
            "child_remaining_due": "0.00",
            "number_of_months": 1,
            "master_invoice_id": 12,
            "due_date": "2015-10-03",
            "delinquent": false,
            "auto_pay": "2015-09-23",
            "auto_pay_attempted": true,
            "void": false
        }
    }
    ```

## Reverse a credit (POST)
- **Version**: 0.2.0
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/credits/:credit_id/reverse`
- **Description**: Reverse a credit on an invoice. You cannot reverse a credit if the accounting period is closed.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
    - `credit_id` (Number, required): The ID of the credit
- **Success Response (200 OK)**:
    ```json
    {
      "data": [
        {
          "id": 263,
          "amount": 60.50,
          "void": false,
          "deposit_id": 5,
          "discount_id": 0,
          "date": "2015-09-23 16:55:13"
        }
      ],
      "paginator": {
        "total_count": 1,
        "total_pages": 1,
        "current_page": 1,
        "limit": 100
      }
    }
    ```
- **Error Response (422 Unprocessable Entity)**:
    ```json
    {
        "error": {
            "message": {
                "debits": "The accounting period is closed."
            },
            "status_code": 422
        }
    }
    ```

## Unfreeze invoice (POST)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/unfreeze`
- **Description**: Unfreeze an invoice. This requires account super user permissions.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice
- **Success Response (200 OK)**:
    ```json
    {
        "data": {
            "id": 311,
            "date": "2015-09-23",
            "frozen": false,
            "remaining_due": "0.00",
            "child_remaining_due": "0.00",
            "number_of_months": 1,
            "master_invoice_id": 0,
            "due_date": "2015-10-03",
            "delinquent": false,
            "auto_pay": "2015-09-23",
            "auto_pay_attempted": true,
            "void": false
        }
    }
    ```

## Void invoice (POST)
- **Version**: 0.6.6
- **Endpoint**: `https://example.sonar.software/api/v1/accounts/:account_id/invoices/:invoice_id/void`
- **Description**: Void an invoice. Voiding an invoice removes any credits applied from payments or discounts, and reverses all debits on the invoice. The reversed debits will be used to pay off the invoice.
- **Parameters**:
    - `account_id` (Number, required): The ID of the account
    - `invoice_id` (Number, required): The ID of the invoice.
- **Success Response (200 OK)**:
    ```json
    {
      "data": {
        "success": true
      }
    }
    ```
- **Error Response (422 Unprocessable Entity)**:
    ```json
    {
       "error": {
         "message": "Invoice is already voided.",
         "status_code": 422
       }
    }
    ```
```
